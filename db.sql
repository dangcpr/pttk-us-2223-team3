CREATE DATABASE QUANLYKHACHSAN
GO

USE QUANLYKHACHSAN
GO

/*
ALTER TABLE THONG_TIN_KHACH_HANG 
DROP CONSTRAINT IF EXISTS FK_KHACH_HANG_TAI_KHOAN
GO

ALTER TABLE THONG_TIN_KHACH_DOAN
DROP CONSTRAINT IF EXISTS FK_KHACH_DOAN_TAI_KHOAN
GO

ALTER TABLE CHI_TIET_KHACH_DOAN
DROP CONSTRAINT IF EXISTS FK_CHI_TIET_KHACH_DOAN_KHACH_DOAN
GO

ALTER TABLE CHI_TIET_KHACH_DOAN
DROP CONSTRAINT IF EXISTS FK_CHI_TIET_KHACH_DOAN_KHACH_HANG
GO

ALTER TABLE CHI_TIET_DAT_PHONG
DROP CONSTRAINT IF EXISTS FK_CHI_TIET_DAT_PHONG_TAI_KHOAN
GO

ALTER TABLE CHI_TIET_DAT_PHONG
DROP CONSTRAINT IF EXISTS FK_CHI_TIET_DAT_PHONG_THONG_TIN_DAT_PHONG
GO


ALTER TABLE CHI_TIET_YEU_CAU_DAT_PHONG
DROP CONSTRAINT IF EXISTS FK_CHI_TIET_YEU_CAU_DAT_PHONG_TAI_KHOAN
GO

ALTER TABLE CHI_TIET_YEU_CAU_DAT_PHONG
DROP CONSTRAINT IF EXISTS FK_CHI_TIET_YEU_CAU_DAT_PHONG_THONG_TIN_YEU_CAU_DAT_PHONG
GO

ALTER TABLE CHI_TIET_THONG_TIN_PHONG
DROP CONSTRAINT IF EXISTS FK_CHI_TIET_THONG_TIN_PHONG_TAI_KHOAN
GO

ALTER TABLE CHI_TIET_THONG_TIN_PHONG
DROP CONSTRAINT IF EXISTS FK_CHI_TIET_THONG_TIN_PHONG_THONG_TIN_PHONG
GO

ALTER TABLE PHIEU_THONG_TIN_DAT_PHONG
DROP CONSTRAINT IF EXISTS FK_PHIEU_THONG_TIN_DAT_PHONG_TAI_KHOAN_NHAN_VIEN
GO

ALTER TABLE PHIEU_THONG_TIN_DAT_PHONG
DROP CONSTRAINT IF EXISTS FK_PHIEU_THONG_TIN_DAT_PHONG_TAI_KHOAN_KHACH_HANG
GO

ALTER TABLE PHIEU_THONG_TIN_DAT_PHONG
DROP CONSTRAINT IF EXISTS FK_PHIEU_THONG_TIN_DAT_PHONG_THONG_TIN_PHONG_KHACH_SAN
GO

ALTER TABLE PHIEU_FEED_BACK
DROP CONSTRAINT IF EXISTS FK_PHIEU_FEED_BACK_TAI_KHOAN
GO

ALTER TABLE PHIEU_DANG_KY
DROP CONSTRAINT IF EXISTS FK_PHIEU_DANG_KY_TAI_KHOAN
GO

ALTER TABLE LICH_SU_DUNG_DICH_VU
DROP CONSTRAINT IF EXISTS FK_LICH_SU_DUNG_DICH_VU_TAI_KHOAN
GO

ALTER TABLE LICH_SU_DUNG_DICH_VU
DROP CONSTRAINT IF EXISTS FK_LICH_SU_DUNG_DICH_VU_DICH_VU
GO

ALTER TABLE THONG_TIN_DAT_TOUR
DROP CONSTRAINT IF EXISTS FK_THONG_TIN_DAT_TOUR_TAI_KHOAN
GO

ALTER TABLE THONG_TIN_DAT_TOUR
DROP CONSTRAINT IF EXISTS FK_THONG_TIN_DAT_TOUR_DON_VI_LU_HANH
GO

ALTER TABLE TOUR_DU_LICH
DROP CONSTRAINT IF EXISTS FK_TOUR_DU_LICH_DON_VI_LU_HANH
GO

DROP TABLE IF EXISTS TAI_KHOAN;
DROP TABLE IF EXISTS THONG_TIN_KHACH_HANG;
DROP TABLE IF EXISTS THONG_TIN_KHACH_DOAN;
DROP TABLE IF EXISTS CHI_TIET_KHACH_DOAN;
DROP TABLE IF EXISTS THONG_TIN_DAT_PHONG;
DROP TABLE IF EXISTS CHI_TIET_DAT_PHONG;
DROP TABLE IF EXISTS THONG_TIN_YEU_CAU_DAT_PHONG;
DROP TABLE IF EXISTS CHI_TIET_YEU_CAU_DAT_PHONG;
DROP TABLE IF EXISTS THONG_TIN_PHONG_KHACH_SAN;
DROP TABLE IF EXISTS CHI_TIET_THONG_TIN_PHONG;
DROP TABLE IF EXISTS PHIEU_THONG_TIN_DAT_PHONG;
DROP TABLE IF EXISTS PHIEU_FEED_BACK;
DROP TABLE IF EXISTS PHIEU_DANG_KY;
DROP TABLE IF EXISTS LICH_SU_DUNG_DICH_VU;
DROP TABLE IF EXISTS THONG_TIN_DANG_KY_DICH_VU;
DROP TABLE IF EXISTS DICH_VU;
DROP TABLE IF EXISTS TOUR_DU_LICH;
DROP TABLE IF EXISTS DON_VI_LU_HANH;
DROP TABLE IF EXISTS THONG_TIN_DAT_TOUR;
DROP TABLE IF EXISTS THONG_TIN_TAI_XE;
GO
*/

CREATE TABLE TAI_KHOAN (
	USERNAME NVARCHAR(255) NOT NULL,
	PASSWORD NVARCHAR(255) NOT NULL,
	ROLE NVARCHAR(255) NOT NULL,
	CONSTRAINT PK_TAI_KHOAN PRIMARY KEY (USERNAME)
)
GO

CREATE TABLE THONG_TIN_KHACH_HANG (
	MA_KHACH_HANG NVARCHAR(255),
	HO_TEN NVARCHAR(255) NOT NULL,
	DIA_CHI DATE,
	CCCD CHAR(12),
	SDT CHAR(10),
	CONSTRAINT PK_THONG_TIN_KHACH_HANG PRIMARY KEY (MA_KHACH_HANG)
)
GO

CREATE TABLE THONG_TIN_KHACH_DOAN (
	MA_DOAN NVARCHAR(255),
	TEN_DOAN NVARCHAR(255) NOT NULL,
	SO_FAX CHAR(10),
	SO_LUONG INT NOT NULL,
	CONSTRAINT PK_THONG_TIN_KHACH_DOAN PRIMARY KEY (MA_DOAN)
)
GO

CREATE TABLE CHI_TIET_KHACH_DOAN (
	MA_KHACH_HANG NVARCHAR(255),
	MA_DOAN NVARCHAR(255),
	CONSTRAINT PK_CHI_TIET_KHACH_DOAN PRIMARY KEY (MA_KHACH_HANG, MA_DOAN)
)
GO

CREATE TABLE THONG_TIN_DAT_PHONG (
	MA_DP int NOT NULL IDENTITY,
	NGAY_DAT DATE NOT NULL,
	LOAI_PHONG NVARCHAR(255) NOT NULL,
	NGAY_CHECKIN DATE DEFAULT GETDATE(),
	NGAY_CHECKOUT DATE,
	CONSTRAINT PK_THONG_TIN_DAT_PHONG PRIMARY KEY (MA_DP)
)
GO

CREATE TABLE CHI_TIET_DAT_PHONG (
	MA_DP int NOT NULL,
	ID NVARCHAR(255),
	NGAY_GHI_NHAN DATE DEFAULT GETDATE(),
	CONSTRAINT PK_CHI_TIET_DAT_PHONG PRIMARY KEY (MA_DP, ID)
)
GO

CREATE TABLE THONG_TIN_YEU_CAU_DAT_PHONG (
	MA_YEU_CAU int NOT NULL IDENTITY,
	NGAY_DEN DATE,
	SO_DEM_LUU_TRU INT ,
	LOAI_YEU_CAU NVARCHAR(255),
	NGAY_YEU_CAU DATE,
	CONSTRAINT PK_THONG_TIN_YEU_CAU_DAT_PHONG PRIMARY KEY (MA_YEU_CAU)
)
GO

CREATE TABLE CHI_TIET_YEU_CAU_DAT_PHONG (
	MA_YEU_CAU int NOT NULL,
	ID NVARCHAR(255),
	NGAY_GHI_NHAN DATE DEFAULT GETDATE(),
	CONSTRAINT PK_CHI_TIET_YEU_CAU_DAT_PHONG PRIMARY KEY (MA_YEU_CAU, ID)
)
GO

CREATE TABLE THONG_TIN_PHONG_KHACH_SAN (
	MA_PHONG int NOT NULL IDENTITY,
	LOAI_PHONG NVARCHAR(255) NOT NULL,
	GIA_TIEN INT NOT NULL,
	NGAY_THUE DATE,
	NGAY_TRA DATE,
	TINH_TRANG NVARCHAR(255),
	DON_DEP BIT,
	CONSTRAINT PK_THONG_TIN_PHONG_KHACH_SAN PRIMARY KEY (MA_PHONG)
)
GO

CREATE TABLE CHI_TIET_THONG_TIN_PHONG (
	MA_PHONG int NOT NULL,
	ID NVARCHAR(255),
	NGAY_CAP_NHAT DATE DEFAULT GETDATE(),
	CONSTRAINT PK_CHI_TIET_THONG_TIN_PHONG PRIMARY KEY (MA_PHONG, ID)
)
GO

CREATE TABLE PHIEU_THONG_TIN_DAT_PHONG (
	MA_PHIEU int NOT NULL IDENTITY,
	MA_PHONG int NOT NULL,
	MA_KHACH_HANG NVARCHAR(255),
	NGAY_GHI DATE DEFAULT GETDATE(),
	MA_NV_GHI_NHAN NVARCHAR(255),
	CONSTRAINT PK_PHIEU_THONG_TIN_DAT_PHONG PRIMARY KEY (MA_PHIEU)
)
GO

CREATE TABLE PHIEU_FEED_BACK (
	MA_PHIEU int NOT NULL,
	MA_KHACH_HANG NVARCHAR(255),
	NOI_DUNG NVARCHAR(255),
	NGAY_FEED_BACK DATE DEFAULT GETDATE(),
	CONSTRAINT PK_PHIEU_FEED_BACK PRIMARY KEY (MA_PHIEU, MA_KHACH_HANG)
)
GO

CREATE TABLE PHIEU_DANG_KY (
	MA_PHIEU int NOT NULL,
	MA_KHACH_HANG NVARCHAR(255),
	CCCD CHAR(12) NOT NULL,
	SO_DEM_O INT NOT NULL,
	CONSTRAINT PK_PHIEU_DANG_KY_KHACH_HANG PRIMARY KEY (MA_PHIEU, MA_KHACH_HANG)
)
GO

CREATE TABLE LICH_SU_DUNG_DICH_VU (
	MA_LICH int NOT NULL IDENTITY,
	NGAY DATE DEFAULT GETDATE(),
	MA_DICH_VU int NOT NULL,
	MA_KHACH_HANG NVARCHAR(255),
	CONSTRAINT PK_LICH_SU_DUNG_DICH_VU PRIMARY KEY (MA_LICH)
)
GO

CREATE TABLE THONG_TIN_DANG_KY_DICH_VU (
	MA_DICH_VU int NOT NULL IDENTITY,
	MA_KHACH_HANG NVARCHAR(255),
	NGAY DATE DEFAULT GETDATE(),
	SO_LUONG INT NOT NULL,
	THANH_TIEN INT NOT NULL,
	TINH_TRANG_THANH_TOAN NVARCHAR(255),
	CONSTRAINT PK_THONG_TIN_DANG_KY_DICH_VU PRIMARY KEY (MA_DICH_VU)
)
GO

CREATE TABLE DON_VI_LU_HANH (
	MA_DON_VI int NOT NULL IDENTITY,
	TEN_DON_VI NVARCHAR(255) NOT NULL,
	CONSTRAINT PK_DON_VI_LU_HANH PRIMARY KEY (MA_DON_VI)
)
GO

CREATE TABLE THONG_TIN_DAT_TOUR (
	MA_DAT_TOUR int NOT NULL IDENTITY,
	MA_KHACH_HANG NVARCHAR(255),
	MA_DON_VI_LU_HANH int NOT NULL,
	THOI_GIAN DATE DEFAULT GETDATE(),
	CONSTRAINT PK_THONG_TIN_DAT_TOUR PRIMARY KEY (MA_DAT_TOUR)
)
GO

CREATE TABLE DICH_VU (
	MA_DICH_VU int NOT NULL IDENTITY,
	TEN_DICH_VU NVARCHAR(255) NOT NULL,
	LOAI NVARCHAR(255) NOT NULL,
	LOAI_PHONG_CHO_PHEP NVARCHAR(255) NOT NULL,
	GIA_TIEN INT NOT NULL,
	MO_TA NVARCHAR(255),
	TINH_TRANG NVARCHAR(255),
	CONSTRAINT PK_DICH_VU PRIMARY KEY (MA_DICH_VU)
)

CREATE TABLE TOUR_DU_LICH (
	MA_TOUR int NOT NULL IDENTITY,
	MA_DON_VI_LU_HANH int NOT NULL,
	TEN_TOUR NVARCHAR(255) NOT NULL,
	DIA_DIEM NVARCHAR(255) NOT NULL,
	THOI_GIAN DATE DEFAULT GETDATE(),
	PHUONG_TIEN NVARCHAR(255) NOT NULL,
	CONSTRAINT PK_TOUR_DU_LICH PRIMARY KEY (MA_TOUR)
)

CREATE TABLE THONG_TIN_TAI_XE (
	MA_TAI_XE int NOT NULL IDENTITY,
	TEN_TAI_XE NVARCHAR(255) NOT NULL,
	SDT CHAR(10) NOT NULL,
	CONSTRAINT PK_THONG_TIN_TAI_XE PRIMARY KEY (MA_TAI_XE)
)

ALTER TABLE THONG_TIN_KHACH_HANG 
ADD CONSTRAINT FK_KHACH_HANG_TAI_KHOAN
FOREIGN KEY (MA_KHACH_HANG) REFERENCES TAI_KHOAN (USERNAME)
GO

ALTER TABLE THONG_TIN_KHACH_DOAN
ADD CONSTRAINT FK_KHACH_DOAN_TAI_KHOAN
FOREIGN KEY (MA_DOAN) REFERENCES TAI_KHOAN (USERNAME)
GO

ALTER TABLE CHI_TIET_KHACH_DOAN
ADD CONSTRAINT FK_CHI_TIET_KHACH_DOAN_KHACH_DOAN
FOREIGN KEY (MA_DOAN) REFERENCES THONG_TIN_KHACH_DOAN (MA_DOAN)
GO

ALTER TABLE CHI_TIET_KHACH_DOAN
ADD CONSTRAINT FK_CHI_TIET_KHACH_DOAN_KHACH_HANG
FOREIGN KEY (MA_KHACH_HANG) REFERENCES THONG_TIN_KHACH_HANG (MA_KHACH_HANG)
GO

ALTER TABLE CHI_TIET_DAT_PHONG
ADD CONSTRAINT FK_CHI_TIET_DAT_PHONG_TAI_KHOAN
FOREIGN KEY (ID) REFERENCES TAI_KHOAN (USERNAME)
GO

ALTER TABLE CHI_TIET_DAT_PHONG
ADD CONSTRAINT FK_CHI_TIET_DAT_PHONG_THONG_TIN_DAT_PHONG
FOREIGN KEY (MA_DP) REFERENCES THONG_TIN_DAT_PHONG (MA_DP)
GO

ALTER TABLE CHI_TIET_YEU_CAU_DAT_PHONG
ADD CONSTRAINT FK_CHI_TIET_YEU_CAU_DAT_PHONG_TAI_KHOAN
FOREIGN KEY (ID) REFERENCES TAI_KHOAN (USERNAME)
GO

ALTER TABLE CHI_TIET_YEU_CAU_DAT_PHONG
ADD CONSTRAINT FK_CHI_TIET_YEU_CAU_DAT_PHONG_THONG_TIN_YEU_CAU_DAT_PHONG
FOREIGN KEY (MA_YEU_CAU) REFERENCES THONG_TIN_YEU_CAU_DAT_PHONG (MA_YEU_CAU)
GO

ALTER TABLE CHI_TIET_THONG_TIN_PHONG
ADD CONSTRAINT FK_CHI_TIET_THONG_TIN_PHONG_TAI_KHOAN
FOREIGN KEY (ID) REFERENCES TAI_KHOAN (USERNAME)
GO

ALTER TABLE CHI_TIET_THONG_TIN_PHONG
ADD CONSTRAINT FK_CHI_TIET_THONG_TIN_PHONG_THONG_TIN_PHONG_KHACH_SAN
FOREIGN KEY (MA_PHONG) REFERENCES THONG_TIN_PHONG_KHACH_SAN (MA_PHONG)
GO

ALTER TABLE PHIEU_THONG_TIN_DAT_PHONG
ADD CONSTRAINT FK_PHIEU_THONG_TIN_DAT_PHONG_TAI_KHOAN_NHAN_VIEN
FOREIGN KEY (MA_NV_GHI_NHAN) REFERENCES TAI_KHOAN (USERNAME)
GO

ALTER TABLE PHIEU_THONG_TIN_DAT_PHONG
ADD CONSTRAINT FK_PHIEU_THONG_TIN_DAT_PHONG_TAI_KHOAN_KHACH_HANG
FOREIGN KEY (MA_KHACH_HANG) REFERENCES TAI_KHOAN (USERNAME)
GO

ALTER TABLE PHIEU_THONG_TIN_DAT_PHONG
ADD CONSTRAINT FK_PHIEU_THONG_TIN_DAT_PHONG_THONG_TIN_PHONG_KHACH_SAN
FOREIGN KEY (MA_PHONG) REFERENCES THONG_TIN_PHONG_KHACH_SAN (MA_PHONG)
GO

ALTER TABLE PHIEU_FEED_BACK
ADD CONSTRAINT FK_PHIEU_FEED_BACK_TAI_KHOAN
FOREIGN KEY (MA_KHACH_HANG) REFERENCES TAI_KHOAN (USERNAME)
GO

ALTER TABLE PHIEU_DANG_KY
ADD CONSTRAINT FK_PHIEU_DANG_KY_TAI_KHOAN
FOREIGN KEY (MA_KHACH_HANG) REFERENCES TAI_KHOAN (USERNAME)
GO

ALTER TABLE LICH_SU_DUNG_DICH_VU
ADD CONSTRAINT FK_LICH_SU_DUNG_DICH_VU_TAI_KHOAN
FOREIGN KEY (MA_KHACH_HANG) REFERENCES TAI_KHOAN (USERNAME)
GO

ALTER TABLE LICH_SU_DUNG_DICH_VU
ADD CONSTRAINT FK_LICH_SU_DUNG_DICH_VU_DICH_VU
FOREIGN KEY (MA_DICH_VU) REFERENCES DICH_VU (MA_DICH_VU)
GO

ALTER TABLE THONG_TIN_DAT_TOUR
ADD CONSTRAINT FK_THONG_TIN_DAT_TOUR_TAI_KHOAN
FOREIGN KEY (MA_KHACH_HANG) REFERENCES TAI_KHOAN (USERNAME)
GO

ALTER TABLE THONG_TIN_DAT_TOUR
ADD CONSTRAINT FK_THONG_TIN_DAT_TOUR_DON_VI_LU_HANH
FOREIGN KEY (MA_DON_VI_LU_HANH) REFERENCES DON_VI_LU_HANH (MA_DON_VI)
GO

ALTER TABLE TOUR_DU_LICH
ADD CONSTRAINT FK_TOUR_DU_LICH_DON_VI_LU_HANH
FOREIGN KEY (MA_DON_VI_LU_HANH) REFERENCES DON_VI_LU_HANH (MA_DON_VI)
GO

INSERT INTO TAI_KHOAN (USERNAME, PASSWORD, ROLE) VALUES ('bellman1', '123', N'Bellman');
INSERT INTO TAI_KHOAN (USERNAME, PASSWORD, ROLE) VALUES ('khachhang1', '123', N'Khách hàng');
INSERT INTO TAI_KHOAN (USERNAME, PASSWORD, ROLE) VALUES ('letan1', '123', N'Lễ tân');
