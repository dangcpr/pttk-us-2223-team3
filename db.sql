CREATE DATABASE QUANLYKHACHSAN
GO

USE QUANLYKHACHSAN
GO

/*
ALTER TABLE THONG_TIN_KHACH_HANG 
DROP CONSTRAINT IF EXISTS FK_KHACH_HANG_TAI_KHOAN
GO

ALTER TABLE THONG_TIN_KHACH_DOAN
DROP CONSTRAINT IF EXISTS FK_KHACH_DOAN_TAI_KHOAN
GO

ALTER TABLE CHI_TIET_KHACH_DOAN
DROP CONSTRAINT IF EXISTS FK_CHI_TIET_KHACH_DOAN_KHACH_DOAN
GO

ALTER TABLE CHI_TIET_KHACH_DOAN
DROP CONSTRAINT IF EXISTS FK_CHI_TIET_KHACH_DOAN_KHACH_HANG
GO

ALTER TABLE THONG_TIN_DAT_PHONG
DROP CONSTRAINT IF EXISTS FK_THONG_TIN_DAT_PHONG_TAI_KHOAN
GO


ALTER TABLE CHI_TIET_DAT_PHONG
DROP CONSTRAINT IF EXISTS FK_CHI_TIET_DAT_PHONG_THONG_TIN_DAT_PHONG
GO

ALTER TABLE CHI_TIET_YEU_CAU_DAT_PHONG
DROP CONSTRAINT IF EXISTS FK_CHI_TIET_YEU_CAU_DAT_PHONG_THONG_TIN_YEU_CAU_DAT_PHONG
GO

ALTER TABLE CHI_TIET_THONG_TIN_PHONG
DROP CONSTRAINT IF EXISTS FK_CHI_TIET_THONG_TIN_PHONG_THONG_TIN_PHONG
GO

ALTER TABLE CHI_TIET_THONG_TIN_PHONG
DROP CONSTRAINT FK_CHI_TIET_THONG_TIN_PHONG_THONG_TIN_PHONG_KHACH_SAN
GO

ALTER TABLE PHIEU_THONG_TIN_DAT_PHONG
DROP CONSTRAINT IF EXISTS FK_PHIEU_THONG_TIN_DAT_PHONG_TAI_KHOAN_NHAN_VIEN
GO

ALTER TABLE PHIEU_THONG_TIN_DAT_PHONG
DROP CONSTRAINT IF EXISTS FK_PHIEU_THONG_TIN_DAT_PHONG_TAI_KHOAN_KHACH_HANG
GO

ALTER TABLE PHIEU_THONG_TIN_DAT_PHONG
DROP CONSTRAINT IF EXISTS FK_PHIEU_THONG_TIN_DAT_PHONG_THONG_TIN_PHONG_KHACH_SAN
GO

ALTER TABLE PHIEU_THONG_TIN_DAT_PHONG
DROP CONSTRAINT IF EXISTS FK_PHIEU_THONG_TIN_DAT_PHONG_THONG_TIN_DAT_PHONG
GO

ALTER TABLE PHIEU_FEED_BACK
DROP CONSTRAINT IF EXISTS FK_PHIEU_FEED_BACK_TAI_KHOAN
GO

ALTER TABLE PHIEU_DANG_KY
DROP CONSTRAINT IF EXISTS FK_PHIEU_DANG_KY_TAI_KHOAN
GO

ALTER TABLE LICH_SU_DUNG_DICH_VU
DROP CONSTRAINT IF EXISTS FK_LICH_SU_DUNG_DICH_VU_TAI_KHOAN
GO

ALTER TABLE LICH_SU_DUNG_DICH_VU
DROP CONSTRAINT IF EXISTS FK_LICH_SU_DUNG_DICH_VU_DICH_VU
GO

ALTER TABLE THONG_TIN_DAT_TOUR
DROP CONSTRAINT IF EXISTS FK_THONG_TIN_DAT_TOUR_TAI_KHOAN
GO

ALTER TABLE THONG_TIN_DAT_TOUR
DROP CONSTRAINT IF EXISTS FK_THONG_TIN_DAT_TOUR_DON_VI_LU_HANH
GO

ALTER TABLE TOUR_DU_LICH
DROP CONSTRAINT IF EXISTS FK_TOUR_DU_LICH_DON_VI_LU_HANH
GO

ALTER TABLE THONG_TIN_DANG_KY_DICH_VU
DROP CONSTRAINT IF EXISTS FK_THONG_TIN_DANG_KY_DICH_VU_TAI_KHOAN
GO

ALTER TABLE THONG_TIN_YEU_CAU_DAT_PHONG
DROP CONSTRAINT IF EXISTS FK_TTHONG_TIN_YEU_CAU_DAT_PHONG_DICH_VU_TAI_KHOAN
GO

ALTER TABLE THONG_TIN_DANG_KY_DICH_VU
DROP CONSTRAINT IF EXISTS FK_THONG_TIN_DANG_KY_DICH_VU_DICH_VU
GO

ALTER TABLE HOA_DON
DROP CONSTRAINT IF EXISTS FK_HOA_DON_TAI_KHOAN
GO

ALTER TABLE CHI_TIET_HOA_DON
DROP CONSTRAINT IF EXISTS FK_CHI_TIET_HOA_DON_HOA_DON
GO

ALTER TABLE CHI_TIET_HOA_DON 
DROP CONSTRAINT IF EXISTS FK_CHI_TIET_HOA_DON_THONG_TIN_DANG_KY_DICH_VU 
GO

DROP TABLE IF EXISTS TAI_KHOAN;
DROP TABLE IF EXISTS THONG_TIN_KHACH_HANG;
DROP TABLE IF EXISTS THONG_TIN_KHACH_DOAN;
DROP TABLE IF EXISTS CHI_TIET_KHACH_DOAN;
DROP TABLE IF EXISTS THONG_TIN_DAT_PHONG;
DROP TABLE IF EXISTS CHI_TIET_DAT_PHONG;
DROP TABLE IF EXISTS THONG_TIN_YEU_CAU_DAT_PHONG;
DROP TABLE IF EXISTS CHI_TIET_YEU_CAU_DAT_PHONG;
DROP TABLE IF EXISTS THONG_TIN_PHONG_KHACH_SAN;
DROP TABLE IF EXISTS CHI_TIET_THONG_TIN_PHONG;
DROP TABLE IF EXISTS PHIEU_THONG_TIN_DAT_PHONG;
DROP TABLE IF EXISTS PHIEU_FEED_BACK;
DROP TABLE IF EXISTS PHIEU_DANG_KY;
DROP TABLE IF EXISTS LICH_SU_DUNG_DICH_VU;
DROP TABLE IF EXISTS THONG_TIN_DANG_KY_DICH_VU;
DROP TABLE IF EXISTS DICH_VU;
DROP TABLE IF EXISTS TOUR_DU_LICH;
DROP TABLE IF EXISTS DON_VI_LU_HANH;
DROP TABLE IF EXISTS THONG_TIN_DAT_TOUR;
DROP TABLE IF EXISTS THONG_TIN_TAI_XE;
DROP TABLE IF EXISTS QUY_DINH_KHACH_SAN;
DROP TABLE IF EXISTS HOA_DON;
DROP TABLE IF EXISTS CHI_TIET_HOA_DON;
GO
*/

CREATE TABLE TAI_KHOAN (
	USERNAME NVARCHAR(255) NOT NULL,
	PASSWORD NVARCHAR(255) NOT NULL,
	ROLE NVARCHAR(255) NOT NULL,
	CONSTRAINT PK_TAI_KHOAN PRIMARY KEY (USERNAME)
)
GO

CREATE TABLE THONG_TIN_KHACH_HANG (
	MA_KHACH_HANG NVARCHAR(255),
	HO_TEN NVARCHAR(255) NOT NULL,
	DIA_CHI NVARCHAR(255),
	CCCD CHAR(12),
	SDT CHAR(10),
	CONSTRAINT PK_THONG_TIN_KHACH_HANG PRIMARY KEY (MA_KHACH_HANG)
)
GO

CREATE TABLE THONG_TIN_KHACH_DOAN (
	MA_DOAN NVARCHAR(255),
	NGUOI_DAN_DOAN NVARCHAR(255),
	TEN_DOAN NVARCHAR(255) NOT NULL,
	SO_FAX CHAR(10),
	SO_LUONG INT NOT NULL,
	CONSTRAINT PK_THONG_TIN_KHACH_DOAN PRIMARY KEY (MA_DOAN)
)
GO

CREATE TABLE CHI_TIET_KHACH_DOAN (
	MA_KHACH_HANG NVARCHAR(255),
	MA_DOAN NVARCHAR(255),
	CONSTRAINT PK_CHI_TIET_KHACH_DOAN PRIMARY KEY (MA_KHACH_HANG, MA_DOAN)
)
GO

CREATE TABLE THONG_TIN_DAT_PHONG (
	MA_DP int NOT NULL IDENTITY,
	MA_KHACH_HANG NVARCHAR(255),
	NGAY_DAT DATE NOT NULL,
	LOAI_PHONG NVARCHAR(255) NOT NULL,
	NGAY_CHECKIN DATE DEFAULT GETDATE(),
	NGAY_CHECKOUT DATE,
	CONSTRAINT PK_THONG_TIN_DAT_PHONG PRIMARY KEY (MA_DP)
)
GO

CREATE TABLE CHI_TIET_DAT_PHONG (
	MA_DP int NOT NULL,
	ID INT NOT NULL IDENTITY,
	YEU_CAU NVARCHAR(255),
	NGAY_GHI_NHAN DATE DEFAULT GETDATE(),
	CONSTRAINT PK_CHI_TIET_DAT_PHONG PRIMARY KEY (MA_DP, ID)
)
GO

CREATE TABLE THONG_TIN_YEU_CAU_DAT_PHONG (
	MA_YEU_CAU int NOT NULL IDENTITY,
	MA_KHACH_HANG NVARCHAR(255),
	NGAY_DEN DATE,
	SO_DEM_LUU_TRU INT ,
	LOAI_YEU_CAU NVARCHAR(255),
	NGAY_YEU_CAU DATE,
	CONSTRAINT PK_THONG_TIN_YEU_CAU_DAT_PHONG PRIMARY KEY (MA_YEU_CAU)
)
GO

CREATE TABLE CHI_TIET_YEU_CAU_DAT_PHONG (
	MA_YEU_CAU int NOT NULL,
	ID INT NOT NULL IDENTITY,
	NGAY_GHI_NHAN DATE DEFAULT GETDATE(),
	CONSTRAINT PK_CHI_TIET_YEU_CAU_DAT_PHONG PRIMARY KEY (MA_YEU_CAU, ID)
)
GO

CREATE TABLE THONG_TIN_PHONG_KHACH_SAN (
	MA_PHONG int NOT NULL IDENTITY,
	LOAI_PHONG NVARCHAR(255) NOT NULL,
	GIA_TIEN INT NOT NULL,
	NGAY_THUE DATE,
	NGAY_TRA DATE,
	TINH_TRANG NVARCHAR(255),
	DON_DEP BIT,
	CONSTRAINT PK_THONG_TIN_PHONG_KHACH_SAN PRIMARY KEY (MA_PHONG)
)
GO

CREATE TABLE CHI_TIET_THONG_TIN_PHONG (
	MA_PHONG int NOT NULL,
	ID int NOT NULL IDENTITY,
	NGAY_CAP_NHAT DATE DEFAULT GETDATE(),
	CONSTRAINT PK_CHI_TIET_THONG_TIN_PHONG PRIMARY KEY (MA_PHONG, ID)
)
GO

CREATE TABLE PHIEU_THONG_TIN_DAT_PHONG (
	MA_PHIEU int NOT NULL IDENTITY,
	MA_DP int NOT NULL,
	MA_PHONG int NOT NULL,
	MA_KHACH_HANG NVARCHAR(255),
	NGAY_GHI DATE DEFAULT GETDATE(),
	MA_NV_GHI_NHAN NVARCHAR(255),
	CONSTRAINT PK_PHIEU_THONG_TIN_DAT_PHONG PRIMARY KEY (MA_PHIEU)
)
GO

CREATE TABLE PHIEU_FEED_BACK (
	MA_PHIEU int NOT NULL,
	MA_KHACH_HANG NVARCHAR(255),
	NOI_DUNG NVARCHAR(255),
	NGAY_FEED_BACK DATE DEFAULT GETDATE(),
	CONSTRAINT PK_PHIEU_FEED_BACK PRIMARY KEY (MA_PHIEU, MA_KHACH_HANG)
)
GO

CREATE TABLE PHIEU_DANG_KY (
	MA_PHIEU int NOT NULL,
	MA_KHACH_HANG NVARCHAR(255),
	CCCD CHAR(12) NOT NULL,
	NGAY_CHECK_IN DATE DEFAULT GETDATE(),
	CONSTRAINT PK_PHIEU_DANG_KY_KHACH_HANG PRIMARY KEY (MA_PHIEU, MA_KHACH_HANG)
)
GO

CREATE TABLE LICH_SU_DUNG_DICH_VU (
	MA_LICH int NOT NULL IDENTITY,
	NGAY DATE DEFAULT GETDATE(),
	MA_DICH_VU int NOT NULL,
	MA_KHACH_HANG NVARCHAR(255),
	CONSTRAINT PK_LICH_SU_DUNG_DICH_VU PRIMARY KEY (MA_LICH)
)
GO

CREATE TABLE THONG_TIN_DANG_KY_DICH_VU (
	ID int NOT NULL IDENTITY,
	MA_DICH_VU int NOT NULL,
	MA_KHACH_HANG NVARCHAR(255),
	NGAY DATE DEFAULT GETDATE(),
	SO_LUONG INT NOT NULL,
	THANH_TIEN INT NOT NULL,
	TINH_TRANG_THANH_TOAN NVARCHAR(255),
	CONSTRAINT PK_THONG_TIN_DANG_KY_DICH_VU PRIMARY KEY (ID)
)
GO

CREATE TABLE DON_VI_LU_HANH (
	MA_DON_VI int NOT NULL IDENTITY,
	TEN_DON_VI NVARCHAR(255) NOT NULL,
	CONSTRAINT PK_DON_VI_LU_HANH PRIMARY KEY (MA_DON_VI)
)
GO

CREATE TABLE THONG_TIN_DAT_TOUR (
	MA_DAT_TOUR int NOT NULL IDENTITY,
	MA_KHACH_HANG NVARCHAR(255),
	MA_DON_VI_LU_HANH int NOT NULL,
	THOI_GIAN DATE DEFAULT GETDATE(),
	CONSTRAINT PK_THONG_TIN_DAT_TOUR PRIMARY KEY (MA_DAT_TOUR)
)
GO

CREATE TABLE DICH_VU (
	MA_DICH_VU int NOT NULL IDENTITY,
	TEN_DICH_VU NVARCHAR(255) NOT NULL,
	LOAI NVARCHAR(255) NOT NULL,
	LOAI_PHONG_CHO_PHEP NVARCHAR(255) NOT NULL,
	GIA_TIEN INT NOT NULL,
	MO_TA NVARCHAR(255),
	TINH_TRANG NVARCHAR(255),
	CONSTRAINT PK_DICH_VU PRIMARY KEY (MA_DICH_VU)
)
GO

CREATE TABLE TOUR_DU_LICH (
	MA_TOUR int NOT NULL IDENTITY,
	MA_DON_VI_LU_HANH int NOT NULL,
	TEN_TOUR NVARCHAR(255) NOT NULL,
	DIA_DIEM NVARCHAR(255) NOT NULL,
	THOI_GIAN DATE DEFAULT GETDATE(),
	PHUONG_TIEN NVARCHAR(255) NOT NULL,
	CONSTRAINT PK_TOUR_DU_LICH PRIMARY KEY (MA_TOUR)
)
GO

CREATE TABLE THONG_TIN_TAI_XE (
	MA_TAI_XE int NOT NULL IDENTITY,
	TEN_TAI_XE NVARCHAR(255) NOT NULL,
	SDT CHAR(10) NOT NULL,
	CONSTRAINT PK_THONG_TIN_TAI_XE PRIMARY KEY (MA_TAI_XE)
)
GO

CREATE TABLE QUY_DINH_KHACH_SAN (
	MA_QUY_DINH int NOT NULL IDENTITY,
	NOI_DUNG NVARCHAR(255) NOT NULL,
)
GO

CREATE TABLE HOA_DON (
	MA_HOA_DON int NOT NULL IDENTITY,
	NGAY_XUAT DATE DEFAULT GETDATE(),
	TIEN_PHONG FLOAT,
	TONG_TIEN INT,
	TINH_TRANG_THANH_TOAN NVARCHAR(255),
	LE_TAN_GHI_NHAN NVARCHAR(255) NOT NULL,
	CONSTRAINT PK_HOA_DON PRIMARY KEY(MA_HOA_DON),
	CONSTRAINT FK_HOA_DON_TAI_KHOAN FOREIGN KEY(LE_TAN_GHI_NHAN) REFERENCES TAI_KHOAN(USERNAME)
)
GO

CREATE TABLE CHI_TIET_HOA_DON (
	MA_HOA_DON int,
	MA_DICH_VU int,
	MA_KHACH_HANG NVARCHAR(255),
	SO_LUONG INT NOT NULL,
	DON_GIA INT NOT NULL,
	THANH_TIEN INT NOT NULL,
	CONSTRAINT PK_CHI_TIET_HOA_DON PRIMARY KEY(MA_HOA_DON,MA_DICH_VU,MA_KHACH_HANG),
	CONSTRAINT FK_CHI_TIET_HOA_DON_HOA_DON FOREIGN KEY(MA_HOA_DON) REFERENCES HOA_DON(MA_HOA_DON),
	CONSTRAINT FK_CHI_TIET_HOA_DON_THONG_TIN_DANG_KY_DICH_VU FOREIGN KEY(MA_DICH_VU,MA_KHACH_HANG) REFERENCES THONG_TIN_DANG_KY_DICH_VU(MA_DICH_VU,MA_KHACH_HANG)
)
GO

CREATE TABLE KHUYEN_MAI (
	MA_KHUYEN_MAI int NOT NULL IDENTITY,
	NOI_DUNG NVARCHAR(255) NOT NULL,
	NGAY_BAT_DAU DATETIME,
	NGAY_KET_THUC DATETIME,
	CONSTRAINT PK_KHUYEN_MAI PRIMARY KEY (MA_KHUYEN_MAI)
)
GO

ALTER TABLE PHIEU_DANG_KY
DROP COLUMN SO_DEM_O;
GO
ALTER TABLE PHIEU_DANG_KY
ADD NGAY_CHECK_IN DATE;
GO
ALTER TABLE PHIEU_DANG_KY
ADD GHI_CHU NVARCHAR(250);

ALTER TABLE PHIEU_DANG_KY
DROP COLUMN MA_PHIEU;

ALTER TABLE PHIEU_DANG_KY
ADD MA_PHIEU INT IDENTITY (1, 1) NOT NULL;

ALTER TABLE THONG_TIN_KHACH_HANG 
ADD CONSTRAINT FK_KHACH_HANG_TAI_KHOAN
FOREIGN KEY (MA_KHACH_HANG) REFERENCES TAI_KHOAN (USERNAME)
GO

ALTER TABLE THONG_TIN_KHACH_DOAN
ADD CONSTRAINT FK_KHACH_DOAN_TAI_KHOAN
FOREIGN KEY (MA_DOAN) REFERENCES TAI_KHOAN (USERNAME)
GO

ALTER TABLE THONG_TIN_KHACH_DOAN
ADD CONSTRAINT FK_KHACH_DOAN_NGUOI_DAN_DOAN
FOREIGN KEY (NGUOI_DAN_DOAN) REFERENCES THONG_TIN_KHACH_HANG (MA_KHACH_HANG)
GO

ALTER TABLE CHI_TIET_KHACH_DOAN
ADD CONSTRAINT FK_CHI_TIET_KHACH_DOAN_KHACH_DOAN
FOREIGN KEY (MA_DOAN) REFERENCES THONG_TIN_KHACH_DOAN (MA_DOAN)
GO

ALTER TABLE CHI_TIET_KHACH_DOAN
ADD CONSTRAINT FK_CHI_TIET_KHACH_DOAN_KHACH_HANG
FOREIGN KEY (MA_KHACH_HANG) REFERENCES THONG_TIN_KHACH_HANG (MA_KHACH_HANG)
GO

ALTER TABLE THONG_TIN_DAT_PHONG
ADD CONSTRAINT FK_THONG_TIN_DAT_PHONG_TAI_KHOAN
FOREIGN KEY (MA_KHACH_HANG) REFERENCES TAI_KHOAN (USERNAME)


ALTER TABLE CHI_TIET_DAT_PHONG
ADD CONSTRAINT FK_CHI_TIET_DAT_PHONG_THONG_TIN_DAT_PHONG
FOREIGN KEY (MA_DP) REFERENCES THONG_TIN_DAT_PHONG (MA_DP)
GO


ALTER TABLE CHI_TIET_YEU_CAU_DAT_PHONG
ADD CONSTRAINT FK_CHI_TIET_YEU_CAU_DAT_PHONG_THONG_TIN_YEU_CAU_DAT_PHONG
FOREIGN KEY (MA_YEU_CAU) REFERENCES THONG_TIN_YEU_CAU_DAT_PHONG (MA_YEU_CAU)
GO

ALTER TABLE CHI_TIET_THONG_TIN_PHONG
ADD CONSTRAINT FK_CHI_TIET_THONG_TIN_PHONG_THONG_TIN_PHONG_KHACH_SAN
FOREIGN KEY (MA_PHONG) REFERENCES THONG_TIN_PHONG_KHACH_SAN (MA_PHONG)
GO

ALTER TABLE PHIEU_THONG_TIN_DAT_PHONG
ADD CONSTRAINT FK_PHIEU_THONG_TIN_DAT_PHONG_TAI_KHOAN_NHAN_VIEN
FOREIGN KEY (MA_NV_GHI_NHAN) REFERENCES TAI_KHOAN (USERNAME)
GO

ALTER TABLE PHIEU_THONG_TIN_DAT_PHONG
ADD CONSTRAINT FK_PHIEU_THONG_TIN_DAT_PHONG_TAI_KHOAN_KHACH_HANG
FOREIGN KEY (MA_KHACH_HANG) REFERENCES TAI_KHOAN (USERNAME)
GO

ALTER TABLE PHIEU_THONG_TIN_DAT_PHONG
ADD CONSTRAINT FK_PHIEU_THONG_TIN_DAT_PHONG_THONG_TIN_PHONG_KHACH_SAN
FOREIGN KEY (MA_PHONG) REFERENCES THONG_TIN_PHONG_KHACH_SAN (MA_PHONG)
GO

ALTER TABLE PHIEU_THONG_TIN_DAT_PHONG
ADD CONSTRAINT FK_PHIEU_THONG_TIN_DAT_PHONG_THONG_TIN_DAT_PHONG
FOREIGN KEY (MA_DP) REFERENCES THONG_TIN_DAT_PHONG (MA_DP)
GO

ALTER TABLE PHIEU_FEED_BACK
ADD CONSTRAINT FK_PHIEU_FEED_BACK_TAI_KHOAN
FOREIGN KEY (MA_KHACH_HANG) REFERENCES TAI_KHOAN (USERNAME)
GO

ALTER TABLE PHIEU_DANG_KY
ADD CONSTRAINT FK_PHIEU_DANG_KY_TAI_KHOAN
FOREIGN KEY (MA_KHACH_HANG) REFERENCES TAI_KHOAN (USERNAME)
GO

ALTER TABLE LICH_SU_DUNG_DICH_VU
ADD CONSTRAINT FK_LICH_SU_DUNG_DICH_VU_TAI_KHOAN
FOREIGN KEY (MA_KHACH_HANG) REFERENCES TAI_KHOAN (USERNAME)
GO

ALTER TABLE LICH_SU_DUNG_DICH_VU
ADD CONSTRAINT FK_LICH_SU_DUNG_DICH_VU_DICH_VU
FOREIGN KEY (MA_DICH_VU) REFERENCES DICH_VU (MA_DICH_VU)
GO

ALTER TABLE THONG_TIN_DAT_TOUR
ADD CONSTRAINT FK_THONG_TIN_DAT_TOUR_TAI_KHOAN
FOREIGN KEY (MA_KHACH_HANG) REFERENCES TAI_KHOAN (USERNAME)
GO

ALTER TABLE THONG_TIN_DAT_TOUR
ADD CONSTRAINT FK_THONG_TIN_DAT_TOUR_DON_VI_LU_HANH
FOREIGN KEY (MA_DON_VI_LU_HANH) REFERENCES DON_VI_LU_HANH (MA_DON_VI)
GO

ALTER TABLE TOUR_DU_LICH
ADD CONSTRAINT FK_TOUR_DU_LICH_DON_VI_LU_HANH
FOREIGN KEY (MA_DON_VI_LU_HANH) REFERENCES DON_VI_LU_HANH (MA_DON_VI)
GO

ALTER TABLE THONG_TIN_DANG_KY_DICH_VU
ADD CONSTRAINT FK_THONG_TIN_DANG_KY_DICH_VU_TAI_KHOAN
FOREIGN KEY (MA_KHACH_HANG) REFERENCES TAI_KHOAN (USERNAME)
GO

ALTER TABLE THONG_TIN_YEU_CAU_DAT_PHONG
ADD CONSTRAINT FK_TTHONG_TIN_YEU_CAU_DAT_PHONG_DICH_VU_TAI_KHOAN
FOREIGN KEY (MA_KHACH_HANG) REFERENCES TAI_KHOAN (USERNAME)
GO

ALTER TABLE THONG_TIN_DANG_KY_DICH_VU
ADD CONSTRAINT FK_THONG_TIN_DANG_KY_DICH_VU_DICH_VU
FOREIGN KEY (MA_DICH_VU) REFERENCES DICH_VU (MA_DICH_VU)
GO

ALTER TABLE THONG_TIN_DAT_PHONG
ADD CONSTRAINT FK_THONG_TIN_DANG_KY_DICH_VU_DICH_VU
FOREIGN KEY (MA_DICH_VU) REFERENCES DICH_VU (MA_DICH_VU)
GO

ALTER TABLE THONG_TIN_DAT_PHONG
ADD CONSTRAINT FK_THONG_TIN_DAT_PHONG_KHUYEN_MAI
FOREIGN KEY (KHUYEN_MAI) REFERENCES KHUYEN_MAI (MA_KHUYEN_MAI)


INSERT INTO TAI_KHOAN (USERNAME, PASSWORD, ROLE) VALUES ('bellman1', '123', N'Bellman');
INSERT INTO TAI_KHOAN (USERNAME, PASSWORD, ROLE) VALUES ('bellman2', '123', N'Bellman');
INSERT INTO TAI_KHOAN (USERNAME, PASSWORD, ROLE) VALUES ('bellman3', '123', N'Bellman');
INSERT INTO TAI_KHOAN (USERNAME, PASSWORD, ROLE) VALUES ('khachhang1', '123', N'Khách hàng');
INSERT INTO TAI_KHOAN (USERNAME, PASSWORD, ROLE) VALUES ('khachhang2', '123', N'Khách hàng');
INSERT INTO TAI_KHOAN (USERNAME, PASSWORD, ROLE) VALUES ('khachhang3', '123', N'Khách hàng');
INSERT INTO TAI_KHOAN (USERNAME, PASSWORD, ROLE) VALUES ('doan1', '123', N'Khách hàng');
INSERT INTO TAI_KHOAN (USERNAME, PASSWORD, ROLE) VALUES ('doan2', '123', N'Khách hàng');
INSERT INTO TAI_KHOAN (USERNAME, PASSWORD, ROLE) VALUES ('letan1', '123', N'Lễ tân');
INSERT INTO TAI_KHOAN (USERNAME, PASSWORD, ROLE) VALUES ('letan2', '123', N'Lễ tân');
INSERT INTO TAI_KHOAN (USERNAME, PASSWORD, ROLE) VALUES ('letan3', '123', N'Lễ tân');
GO

INSERT INTO THONG_TIN_KHACH_HANG (MA_KHACH_HANG , HO_TEN , DIA_CHI, CCCD, SDT) VALUES ('khachhang1', N'Lê Minh Trí', N'TP Hồ Chí Minh', '078223051256'  ,'0933491044');
INSERT INTO THONG_TIN_KHACH_HANG (MA_KHACH_HANG , HO_TEN , DIA_CHI, CCCD, SDT) VALUES ('khachhang2', N'Nguyễn Lê Hải Đăng', N'TP Hà Nội', '029302511692'  ,'0934591051');
INSERT INTO THONG_TIN_KHACH_HANG (MA_KHACH_HANG , HO_TEN , DIA_CHI, CCCD, SDT) VALUES ('khachhang3', N'Trần Minh Triết', N'TP Đà nẵng', '045206091294'  ,'0931791142');
GO


INSERT INTO THONG_TIN_KHACH_DOAN (MA_DOAN, TEN_DOAN, SO_FAX, SO_LUONG) VALUES ('doan1', N'Đoàn du lịch Vintour', '0399452046', 1);
INSERT INTO THONG_TIN_KHACH_DOAN (MA_DOAN, TEN_DOAN, SO_FAX, SO_LUONG) VALUES ('doan2', N'Đoàn du lịch Suntour', '0399514652', 2);
GO

INSERT INTO CHI_TIET_KHACH_DOAN (MA_KHACH_HANG, MA_DOAN) VALUES ('khachhang1', 'doan1');
INSERT INTO CHI_TIET_KHACH_DOAN (MA_KHACH_HANG, MA_DOAN) VALUES ('khachhang2', 'doan2');
INSERT INTO CHI_TIET_KHACH_DOAN (MA_KHACH_HANG, MA_DOAN) VALUES ('khachhang3', 'doan2');
GO

INSERT INTO THONG_TIN_PHONG_KHACH_SAN (TINH_TRANG, LOAI_PHONG, GIA_TIEN) VALUES (N'Trống', N'Thường', 300000);
INSERT INTO THONG_TIN_PHONG_KHACH_SAN (TINH_TRANG, LOAI_PHONG, GIA_TIEN) VALUES (N'Trống', N'Thường', 300000);
INSERT INTO THONG_TIN_PHONG_KHACH_SAN (TINH_TRANG, LOAI_PHONG, GIA_TIEN) VALUES (N'Trống', N'Vip', 400000);
INSERT INTO THONG_TIN_PHONG_KHACH_SAN (TINH_TRANG, LOAI_PHONG, GIA_TIEN) VALUES (N'Trống', N'Vip', 400000);
INSERT INTO THONG_TIN_PHONG_KHACH_SAN (TINH_TRANG, LOAI_PHONG, GIA_TIEN) VALUES (N'Trống', N'Vip', 300000);
SELECT * FROM THONG_TIN_PHONG_KHACH_SAN
--DROP TABLE IF EXISTS THONG_TIN_DAT_PHONG
GO

INSERT INTO QUY_DINH_KHACH_SAN (NOI_DUNG) VALUES (N'Không được tự ý rời khỏi phòng qua đêm')
INSERT INTO QUY_DINH_KHACH_SAN (NOI_DUNG) VALUES (N'Khai báo thông tin rõ ràng')
INSERT INTO QUY_DINH_KHACH_SAN (NOI_DUNG) VALUES (N'Không được mang vật nuôi vào khách sạn')
INSERT INTO QUY_DINH_KHACH_SAN (NOI_DUNG) VALUES (N'Không tàng trữ chất cấm')

INSERT INTO THONG_TIN_YEU_CAU_DAT_PHONG (MA_KHACH_HANG, NGAY_DEN, SO_DEM_LUU_TRU, LOAI_YEU_CAU, NGAY_YEU_CAU) VALUES ('khachhang1', '2023-5-26', 3, N'Phòng gần nhau', '2023-5-25');
DECLARE @MA_YEU_CAU INT;
SET @MA_YEU_CAU = (SELECT MAX(MA_YEU_CAU) FROM THONG_TIN_YEU_CAU_DAT_PHONG);
INSERT INTO CHI_TIET_YEU_CAU_DAT_PHONG (MA_YEU_CAU) VALUES (@MA_YEU_CAU);
--DELETE FROM QUY_DINH_KHACH_SAN;


--INSERT INTO THONG_TIN_DAT_PHONG (MA_PHONG, MA_KHACH_HANG, MA_NHAN_VIEN, NGAY_DAT, NGAY_CHECK_IN, NGAY_CHECK_OUT) VALUES (3, 'khachhang2', 'letan2', '2023-5-26', '2023-6-2', '2023-6-4');
--GO
--UPDATE THONG_TIN_PHONG_KHACH_SAN SET TINHTRANG = N'Hết' WHERE MAPHONG = 3;

--SELECT * FROM THONG_TIN_PHONG_KHACH_SAN
/*
INSERT INTO THONG_TIN_DAT_PHONG (MA_KHACH_HANG, NGAY_DAT, LOAI_PHONG, NGAY_CHECKIN, NGAY_CHECKOUT) VALUES ('khachhang1', '2023-5-26', N'Thường', '2023-6-2', '2023-6-4');
DECLARE @MA_DP INT;
SET @MA_DP = (SELECT MAX(MA_DP) FROM THONG_TIN_DAT_PHONG);
INSERT INTO CHI_TIET_DAT_PHONG (MA_DP, YEU_CAU) VALUES (@MA_DP, N'Không có yêu cầu');
INSERT INTO PHIEU_THONG_TIN_DAT_PHONG (MA_DP, MA_PHONG, MA_KHACH_HANG, MA_NV_GHI_NHAN) VALUES (@MA_DP, 1, 'khachhang1', 'letan1');
*/
SELECT TTDP.*, CTDP.YEU_CAU, CTDP.NGAY_GHI_NHAN FROM THONG_TIN_DAT_PHONG TTDP JOIN CHI_TIET_DAT_PHONG CTDP ON CTDP.MA_DP = TTDP.MA_DP WHERE CTDP.MA_DP = 1;
SELECT * FROM CHI_TIET_DAT_PHONG;
SELECT * FROM PHIEU_THONG_TIN_DAT_PHONG;
SELECT * FROM THONG_TIN_PHONG_KHACH_SAN;
SELECT TTYCDP.*, CTYCDP.NGAY_GHI_NHAN FROM THONG_TIN_YEU_CAU_DAT_PHONG TTYCDP JOIN CHI_TIET_YEU_CAU_DAT_PHONG CTYCDP ON CTYCDP.MA_YEU_CAU = TTYCDP.MA_YEU_CAU WHERE CTYCDP.MA_YEU_CAU = 1;
SELECT * FROM QUY_DINH_KHACH_SAN
SELECT * FROM THONG_TIN_KHACH_DOAN WHERE MA_DOAN = 'doan1';
SELECT CTKD.MA_KHACH_HANG, CTKD.MA_DOAN, TTKH.HO_TEN, TTKH.DIA_CHI, TTKH.CCCD, TTKH.SDT
 FROM CHI_TIET_KHACH_DOAN CTKD JOIN THONG_TIN_KHACH_HANG TTKH ON CTKD.MA_KHACH_HANG = TTKH.MA_KHACH_HANG WHERE MA_DOAN = 'doan1';
SELECT * FROM THONG_TIN_KHACH_HANG WHERE MA_KHACH_HANG = 'khachhang1';
SELECT TTDP.*, PTTDP.MA_PHONG FROM THONG_TIN_DAT_PHONG TTDP JOIN PHIEU_THONG_TIN_DAT_PHONG PTTDP ON TTDP.MA_DP = PTTDP.MA_DP WHERE PTTDP.MA_PHONG = 2;
SELECT * FROM THONG_TIN_PHONG_KHACH_SAN WHERE LOAI_PHONG = N'Thường';

--Feedback
SELECT ISNULL(MAX(MA_PHIEU),0) FROM PHIEU_FEED_BACK;
SELECT * FROM PHIEU_FEED_BACK;
DELETE FROM PHIEU_FEED_BACK;
UPDATE PHIEU_FEED_BACK SET NOI_DUNG = N'Cảm ơn các bạn nhiều', NGAY_FEED_BACK = FORMAT(GETDATE(), 'yyyy-MM-dd') WHERE MA_KHACH_HANG = 'khachhang1' AND MA_PHIEU = 1

INSERT INTO THONG_TIN_DAT_PHONG (MA_KHACH_HANG, NGAY_DAT, LOAI_PHONG, NGAY_CHECKIN, NGAY_CHECKOUT)
VALUES ('khachhang1', '2023-05-23', N'Thường', '2023-05-25','2023-05-27');
INSERT INTO PHIEU_THONG_TIN_DAT_PHONG (MA_DP, MA_PHONG, MA_KHACH_HANG, MA_NV_GHI_NHAN) VALUES (7, 1, 'khachhang1', 'letan1');
UPDATE THONG_TIN_PHONG_KHACH_SAN SET TINH_TRANG = N'Hết' WHERE MA_PHONG = 1;

--Dịch vụ
INSERT INTO DICH_VU (TEN_DICH_VU, LOAI, LOAI_PHONG_CHO_PHEP, GIA_TIEN, MO_TA, TINH_TRANG)
VALUES (N'Dịch vụ phòng', N'Phòng', N'Tất cả', 100000, N'Dịch vụ phòng chăm sóc khách hàng', N'Hoạt động')

INSERT INTO DICH_VU (TEN_DICH_VU, LOAI, LOAI_PHONG_CHO_PHEP, GIA_TIEN, MO_TA, TINH_TRANG)
VALUES (N'Dịch vụ đỗ xe', N'Tiện ích', N'Tất cả', 50000, N'Dịch vụ đỗ xe miễn phí cho khách hàng', N'Hoạt động')

INSERT INTO DICH_VU (TEN_DICH_VU, LOAI, LOAI_PHONG_CHO_PHEP, GIA_TIEN, MO_TA, TINH_TRANG)
VALUES (N'Dịch vụ nhà hàng', N'Tiện ích', N'Tất cả', 150000, N'Dịch vụ nhà hàng phục vụ bữa ăn', N'Hoạt động')

INSERT INTO DICH_VU (TEN_DICH_VU, LOAI, LOAI_PHONG_CHO_PHEP, GIA_TIEN, MO_TA, TINH_TRANG)
VALUES (N'Dịch vụ giặt là', N'Tiện ích', N'Thường', 80000, N'Dịch vụ giặt là và là ủi quần áo', N'Hoạt động')

INSERT INTO DICH_VU (TEN_DICH_VU, LOAI, LOAI_PHONG_CHO_PHEP, GIA_TIEN, MO_TA, TINH_TRANG)
VALUES (N'Dịch vụ spa', N'Tiện ích', N'Vip', 250000, N'Dịch vụ spa chăm sóc sức khỏe và làm đẹp', N'Hoạt động')

--Thông tin đăng ký dịch vụ
SET IDENTITY_INSERT THONG_TIN_DANG_KY_DICH_VU ON
INSERT INTO THONG_TIN_DANG_KY_DICH_VU (MA_DICH_VU, MA_KHACH_HANG, NGAY, SO_LUONG, THANH_TIEN, TINH_TRANG_THANH_TOAN)
VALUES (2, 'khachhang1', '2023-05-27', 2, 100000, N'Đã thanh toán')

INSERT INTO THONG_TIN_DANG_KY_DICH_VU (MA_DICH_VU, MA_KHACH_HANG, NGAY, SO_LUONG, THANH_TIEN, TINH_TRANG_THANH_TOAN)
VALUES (1, 'khachhang1', '2023-05-27', 1, 100000, N'Đã thanh toán')

INSERT INTO THONG_TIN_DANG_KY_DICH_VU (MA_DICH_VU, MA_KHACH_HANG, NGAY, SO_LUONG, THANH_TIEN, TINH_TRANG_THANH_TOAN)
VALUES (5, 'khachhang1', '2023-05-26', 3, 750000, N'Chưa thanh toán')

INSERT INTO THONG_TIN_DANG_KY_DICH_VU (MA_DICH_VU, MA_KHACH_HANG, NGAY, SO_LUONG, THANH_TIEN, TINH_TRANG_THANH_TOAN)
VALUES (4, 'khachhang1', '2023-05-25', 1, 80000, N'Đã thanh toán')

INSERT INTO THONG_TIN_DANG_KY_DICH_VU (MA_DICH_VU, MA_KHACH_HANG, NGAY, SO_LUONG, THANH_TIEN, TINH_TRANG_THANH_TOAN)
VALUES (3, 'khachhang1', '2023-05-25', 2, 300000, N'Chưa thanh toán')
SELECT * FROM CHI_TIET_HOA_DON WHERE MA_HOA_DON = 51;

UPDATE THONG_TIN_DANG_KY_DICH_VU
SET TINH_TRANG_THANH_TOAN = N'Chưa thanh toán'
WHERE MA_DICH_VU = 3 OR MA_DICH_VU = 5;

UPDATE THONG_TIN_PHONG_KHACH_SAN
SET TINH_TRANG = N'Hết'
WHERE MA_PHONG = 3 OR MA_PHONG = 1 OR MA_PHONG = 4;

DELETE FROM THONG_TIN_DANG_KY_DICH_VU;

SELECT * FROM THONG_TIN_DANG_KY_DICH_VU;

--Tài xế
INSERT INTO THONG_TIN_TAI_XE (TEN_TAI_XE, SDT)
VALUES (N'Nguyễn Văn Anh', '0123456789')

INSERT INTO THONG_TIN_TAI_XE (TEN_TAI_XE, SDT)
VALUES (N'Trần Thị Bích', '0987654321')

INSERT INTO THONG_TIN_TAI_XE (TEN_TAI_XE, SDT)
VALUES (N'Lê Văn Cường', '0369876542')

INSERT INTO THONG_TIN_TAI_XE (TEN_TAI_XE, SDT)
VALUES (N'Phạm Thị Điệp', '0776543210')

INSERT INTO THONG_TIN_TAI_XE (TEN_TAI_XE, SDT)
VALUES (N'Hoàng Văn Eo', '0901234567')

INSERT INTO THONG_TIN_TAI_XE (TEN_TAI_XE, SDT)
VALUES (N'Nguyễn Thị Fong', '0887654321')

INSERT INTO THONG_TIN_TAI_XE (TEN_TAI_XE, SDT)
VALUES (N'Vũ Văn Giải', '0912345678')

INSERT INTO THONG_TIN_TAI_XE (TEN_TAI_XE, SDT)
VALUES (N'Trần Văn Hùng', '0898765432')

INSERT INTO THONG_TIN_TAI_XE (TEN_TAI_XE, SDT)
VALUES (N'Lê Thị Ích', '0932167890')

INSERT INTO THONG_TIN_TAI_XE (TEN_TAI_XE, SDT)
VALUES (N'Nguyễn Văn Khang', '0976543210')

SELECT * FROM THONG_TIN_DANG_KY_DICH_VU WHERE MA_KHACH_HANG = 'khachhang1' AND TINH_TRANG_THANH_TOAN = N'Chưa thanh toán';

SET IDENTITY_INSERT [dbo].[DON_VI_LU_HANH] ON
INSERT INTO [dbo].[DON_VI_LU_HANH] ([MA_DON_VI], [TEN_DON_VI]) VALUES (1, N'Futa bus')
INSERT INTO [dbo].[DON_VI_LU_HANH] ([MA_DON_VI], [TEN_DON_VI]) VALUES (2, N'Da Lat Oi')
INSERT INTO [dbo].[DON_VI_LU_HANH] ([MA_DON_VI], [TEN_DON_VI]) VALUES (3, N'Hoang Anh')
INSERT INTO [dbo].[DON_VI_LU_HANH] ([MA_DON_VI], [TEN_DON_VI]) VALUES (4, N'Minh Quan')
INSERT INTO [dbo].[DON_VI_LU_HANH] ([MA_DON_VI], [TEN_DON_VI]) VALUES (5, N'Thien Tri')
SET IDENTITY_INSERT [dbo].[DON_VI_LU_HANH] OFF

SET IDENTITY_INSERT [dbo].[TOUR_DU_LICH] ON
INSERT INTO [dbo].[TOUR_DU_LICH] ([MA_TOUR], [MA_DON_VI_LU_HANH], [TEN_TOUR], [DIA_DIEM], [THOI_GIAN], [PHUONG_TIEN]) VALUES (1, 1, N'Da Lat - Thac Ba', N'Thac Ba', N'2023-06-20', N'xe 10 cho')
INSERT INTO [dbo].[TOUR_DU_LICH] ([MA_TOUR], [MA_DON_VI_LU_HANH], [TEN_TOUR], [DIA_DIEM], [THOI_GIAN], [PHUONG_TIEN]) VALUES (2, 2, N'SG oi', N'TP.HCM', N'2023-06-25', N'xe 10 cho')
INSERT INTO [dbo].[TOUR_DU_LICH] ([MA_TOUR], [MA_DON_VI_LU_HANH], [TEN_TOUR], [DIA_DIEM], [THOI_GIAN], [PHUONG_TIEN]) VALUES (4, 1, N'SG oi', N'Ninh Thuan', N'2023-06-20', N'xe 5 cho')
INSERT INTO [dbo].[TOUR_DU_LICH] ([MA_TOUR], [MA_DON_VI_LU_HANH], [TEN_TOUR], [DIA_DIEM], [THOI_GIAN], [PHUONG_TIEN]) VALUES (5, 2, N'SG oi', N'TP.HCM', N'2023-06-21', N'xe 5 cho')
INSERT INTO [dbo].[TOUR_DU_LICH] ([MA_TOUR], [MA_DON_VI_LU_HANH], [TEN_TOUR], [DIA_DIEM], [THOI_GIAN], [PHUONG_TIEN]) VALUES (6, 2, N'SG oi', N'TP.HCM', N'2023-06-21', N'xe 5 cho')
INSERT INTO [dbo].[TOUR_DU_LICH] ([MA_TOUR], [MA_DON_VI_LU_HANH], [TEN_TOUR], [DIA_DIEM], [THOI_GIAN], [PHUONG_TIEN]) VALUES (7, 2, N'SG oi', N'TP.HCM', N'2023-06-21', N'xe 3 cho')
SET IDENTITY_INSERT [dbo].[TOUR_DU_LICH] OFF


INSERT INTO KHUYEN_MAI VALUES (N'Giảm 10% tổng hóa đơn', '2023-6-18', '2023-7-18')
INSERT INTO KHUYEN_MAI VALUES (N'Giảm 20% tiền phòng', '2023-6-18', '2023-7-18')

SELECT * FROM THONG_TIN_DAT_TOUR;
SELECT * FROM THONG_TIN_KHACH_DOAN;
SELECT * FROM CHI_TIET_KHACH_DOAN;
